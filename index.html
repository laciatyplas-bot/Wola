<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="ETERNIVERSE BOOK MASTER v4.0 â€“ Panel redakcyjny EterSeeker."/>
  <title>ETERNIVERSE Â· BOOK MASTER v4.0</title>

  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

  <!-- ICONS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<header class="header">
  <div class="header-grid">
    <div>
      <div class="logo">ETERNIVERSE</div>
      <small>BOOK MASTER v4.0</small>
    </div>
    <div class="world-selector">
      <button class="world-btn active">RdzeÅ„</button>
      <button class="world-btn">Polaris</button>
    </div>
    <div class="status">
      <span>SplÄ…tanie aktywne</span>
    </div>
  </div>
</header>

<nav class="tab-nav">
  <button class="tab-btn active">KsiÄ…Å¼ka</button>
  <button class="tab-btn">OkÅ‚adka</button>
  <button class="tab-btn">Audio</button>
  <button class="tab-btn">Bella AI</button>
  <button class="tab-btn">Eksport</button>
  <button class="tab-btn">PodglÄ…d</button>
</nav>

<main class="main-container">

  <aside class="sidebar">
    <h3>Bramy</h3>
    <div id="gateList"></div>
  </aside>

  <section class="content">

    <!-- BOOK -->
    <div class="tab-content active">
      <div class="editor-header">
        <h2>Åšwiat Â· Brama</h2>
      </div>

      <div class="chapters-panel">
        <div id="chaptersList"></div>
      </div>

      <!-- ðŸ”´ JEDYNY EDYTOR -->
      <div id="mainEditor"
           class="editor-area"
           contenteditable="true"
           spellcheck="false">
      </div>
    </div>

  </section>
</main>

<div id="toastContainer"></div>

<!-- ================= SCRIPTS SYSTEMOWE ================= -->
<script src="js/data.js"></script>
<script src="js/render.js"></script>
<script src="js/editor.js"></script>
<script src="js/app.js"></script>
<script src="js/ai-integration.js"></script>
<script src="js/upload.js"></script>

<!-- ================= TRYB SESJA PISARSKA ================= -->
<script>
'use strict';

class BellaWritingSession {
  constructor() {
    this.active = false;
    this.startTime = 0;
    this.startWords = 0;
    this.editor = document.getElementById('mainEditor');

    this.init();
  }

  init() {
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 's') {
        e.preventDefault();
        this.toggle();
      }
    });
  }

  toggle() {
    this.active ? this.exit() : this.enter();
  }

  enter() {
    if (!this.editor) return;

    this.active = true;
    this.startTime = Date.now();
    this.startWords = this.countWords();

    document.body.classList.add('writing-session');
    this.injectOverlay();

    this.timer = setInterval(() => this.update(), 1000);
  }

  exit() {
    this.active = false;
    clearInterval(this.timer);
    document.body.classList.remove('writing-session');
    document.getElementById('writingSessionOverlay')?.remove();
  }

  update() {
    const t = Math.floor((Date.now() - this.startTime) / 1000);
    const w = this.countWords() - this.startWords;

    document.getElementById('wsTime').textContent = this.formatTime(t);
    document.getElementById('wsWords').textContent = w;
  }

  countWords() {
    return this.editor.innerText.trim().split(/\s+/).filter(Boolean).length;
  }

  formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  injectOverlay() {
    const o = document.createElement('div');
    o.id = 'writingSessionOverlay';
    o.innerHTML = `
      <div class="ws-panel">
        <strong>SESJA PISARSKA</strong>
        <div><span id="wsTime">00:00</span></div>
        <div><span id="wsWords">0</span> sÅ‚Ã³w</div>
        <button id="wsExit">ZakoÅ„cz</button>
      </div>
    `;
    document.body.appendChild(o);
    document.getElementById('wsExit').onclick = () => this.exit();
  }
}

const style = document.createElement('style');
style.textContent = `
.writing-session header,
.writing-session nav,
.writing-session aside,
.writing-session .chapters-panel,
.writing-session .editor-header {
  display:none !important;
}

.writing-session .main-container {
  grid-template-columns: 1fr !important;
}

#writingSessionOverlay {
  position:fixed;
  top:20px;right:20px;
  background:#000;
  color:#0ff;
  padding:14px;
  border-radius:12px;
  z-index:99999;
}

#wsExit {
  margin-top:8px;
  padding:6px 10px;
  font-weight:bold;
}
`;
document.head.appendChild(style);

window.BellaWritingSession = new BellaWritingSession();
</script>

</body>
</html>