<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ETERNIVERSE — BOOK MASTER (BRAMY)</title>

<style>
body{
  margin:0;
  background:#000;
  color:#0ff;
  font-family:system-ui,sans-serif;
}
header{
  padding:12px;
  text-align:center;
  font-weight:800;
  border-bottom:2px solid #0ff;
}
textarea,.editor,select{
  width:100%;
  background:#111;
  color:#0ff;
  font-size:16px;
  padding:10px;
  border:none;
}
textarea{min-height:25vh}
.editor{min-height:30vh}
button{
  width:100%;
  padding:14px;
  margin-top:8px;
  font-size:16px;
  font-weight:800;
  background:#0ff;
  color:#000;
  border:none;
}
.list button{
  background:#111;
  color:#0ff;
}
.badge{
  font-size:12px;
  opacity:.7;
}
.hidden{display:none}
</style>
</head>

<body>

<header>ETERNIVERSE · BOOK MASTER — BRAMY</header>

<textarea id="input">Wklej TU całą książkę.</textarea>
<button onclick="split()">PODZIEL NA ROZDZIAŁY</button>

<div class="list" id="chapters"></div>

<div id="work" class="hidden">

  <div class="editor" id="editor" contenteditable="true"></div>

  <select id="gate">
    <option value="0">BRAMA I — CIENIA</option>
    <option value="1">BRAMA II — GENEZY</option>
    <option value="2">BRAMA III — WOLI</option>
    <option value="3">BRAMA IV — ARCHETYPÓW</option>
    <option value="4">BRAMA V — OBFITOŚCI</option>
    <option value="5">BRAMA VI — CIAŁA</option>
    <option value="6">BRAMA VII — SPLĄTANIA</option>
    <option value="7">BRAMA VIII — CZASU</option>
    <option value="8">BRAMA IX — KOLEKTYWU</option>
    <option value="9">BRAMA X — INTEGRACJI</option>
  </select>

  <button onclick="save()">ZAPISZ ROZDZIAŁ</button>
  <button onclick="shorten()">STREŚĆ</button>
  <button onclick="expand()">ROZWIŃ</button>
  <button onclick="rewrite()">PRZEPISZ</button>

  <button onclick="exportGate()">EKSPORT TEJ BRAMY</button>
</div>

<script>
const GATES=[
  'CIENIA','GENEZY','WOLI','ARCHETYPÓW','OBFITOŚCI',
  'CIAŁA','SPLĄTANIA','CZASU','KOLEKTYWU','INTEGRACJI'
];

let chapters=[];
let active=null;

function split(){
  const t=input.value.trim();
  if(!t) return;
  chapters=t.split(/(?=ROZDZIAŁ|Rozdział|CHAPTER|Chapter)/g)
    .filter(x=>x.trim().length>40)
    .map(x=>({text:x.trim(),gate:0}));
  saveAll();
  render();
}

function render(){
  chaptersDiv.innerHTML='';
  chapters.forEach((c,i)=>{
    const b=document.createElement('button');
    b.innerHTML=`ROZDZIAŁ ${i+1}<br><span class="badge">BRAMA ${c.gate+1} — ${GATES[c.gate]}</span>`;
    b.onclick=()=>openChapter(i);
    chaptersDiv.appendChild(b);
  });
}

function openChapter(i){
  active=i;
  editor.innerText=chapters[i].text;
  gate.value=chapters[i].gate;
  work.classList.remove('hidden');
}

function save(){
  if(active===null) return;
  chapters[active].text=editor.innerText;
  chapters[active].gate=parseInt(gate.value,10);
  saveAll();
  render();
}

function shorten(){
  const w=editor.innerText.split(/\s+/);
  editor.innerText=w.slice(0,80).join(' ')+"\n\n[STRESZCZONE]";
}
function expand(){
  editor.innerText=editor.innerText+"\n\n"+editor.innerText+"\n\n[ROZWINIĘTE]";
}
function rewrite(){
  editor.innerText=editor.innerText.split(/\n+/).map(l=>"— "+l).join("\n\n")+"\n\n[PRZEPISANE]";
}

function exportGate(){
  if(active===null) return;
  const g=parseInt(gate.value,10);
  const txt=chapters
    .filter(c=>c.gate===g)
    .map((c,i)=>`ROZDZIAŁ ${i+1}\n\n${c.text}`)
    .join('\n\n\n');
  download(txt,'brama_'+(g+1)+'_'+GATES[g]+'.txt');
}

function download(t,n){
  const b=new Blob([t],{type:'text/plain'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(b);
  a.download=n;
  a.click();
}

function saveAll(){
  localStorage.setItem('ETERNIVERSE_FULL',JSON.stringify(chapters));
}

(function load(){
  const s=localStorage.getItem('ETERNIVERSE_FULL');
  if(s){chapters=JSON.parse(s);render();}
})();
</script>

</body>
</html>